<!DOCTYPE html>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta charset="utf-8">

<meta name="author" content="Rust Project Developers">
<meta name="description" content="Security advisory database for Rust crates published through https://crates.io">
<title>RUSTSEC-2024-0353: gix-worktree: Refs and paths with reserved Windows device names access the devices › RustSec Advisory Database</title>

<link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,300italic,400italic" rel="stylesheet">
<link href="/css/basic.css" rel="stylesheet">
<link href="/css/highlight.css" rel="stylesheet">
<link href="/css/index.css" rel="stylesheet">

<script src="/js/index.js" defer></script>
<script src="/js/search.js" defer></script>

<header>
  <div class="header-top">
    <h1><a href="/"><img class="logo-image" src="/img/rustsec-logo.svg" /></a></h1>
    
    <div class="search">
      <form onsubmit="return searchform();">
        <input type="search" id="search-term"
               placeholder="Look up package or ID..." required
               size="20">
      </form>
    </div>
    
  </div>
  <nav>
    <div>
      <a href="/">About</a>
      <a href="/advisories/">Advisories</a>
      <a href="/contributing.html">Report Vulnerabilities</a>
    </div>
    <div>
      <a href="https://rust-lang.zulipchat.com/login/#narrow/stream/146229-wg-secure-code/" title="Zulip" aria-label="Zulip"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="height:1em;fill:currentColor"><path d="M473.09 122.97c0 22.69-10.19 42.85-25.72 55.08L296.61 312.69c-2.8 2.4-6.44-1.47-4.42-4.7l55.3-110.72c1.55-3.1-.46-6.91-3.64-6.91H129.36c-33.22 0-60.4-30.32-60.4-67.37 0-37.06 27.18-67.37 60.4-67.37h283.33c33.22-.02 60.4 30.3 60.4 67.35zM129.36 506.05h283.33c33.22 0 60.4-30.32 60.4-67.37 0-37.06-27.18-67.37-60.4-67.37H198.2c-3.18 0-5.19-3.81-3.64-6.91l55.3-110.72c2.02-3.23-1.62-7.1-4.42-4.7L94.68 383.6c-15.53 12.22-25.72 32.39-25.72 55.08 0 37.05 27.18 67.37 60.4 67.37zm522.5-124.15l124.78-179.6v-1.56H663.52v-48.98h190.09v34.21L731.55 363.24v1.56h124.01v48.98h-203.7V381.9zm338.98-230.14V302.6c0 45.09 17.1 68.03 47.43 68.03 31.1 0 48.2-21.77 48.2-68.03V151.76h59.09V298.7c0 80.86-40.82 119.34-109.24 119.34-66.09 0-104.96-36.54-104.96-120.12V151.76h59.48zm244.91 0h59.48v212.25h104.18v49.76h-163.66V151.76zm297 0v262.01h-59.48V151.76h59.48zm90.18 3.5c18.27-3.11 43.93-5.44 80.08-5.44 36.54 0 62.59 7 80.08 20.99 16.72 13.22 27.99 34.99 27.99 60.64 0 25.66-8.55 47.43-24.1 62.2-20.21 19.05-50.15 27.6-85.13 27.6-7.77 0-14.77-.39-20.21-1.17v93.69h-58.7V155.26zm58.7 118.96c5.05 1.17 11.27 1.55 19.83 1.55 31.49 0 50.92-15.94 50.92-42.76 0-24.1-16.72-38.49-46.26-38.49-12.05 0-20.21 1.17-24.49 2.33v77.37z"/></svg></a>
      <a href="https://twitter.com/RustSec/" title="Twitter" aria-label="Twitter"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="height:1em;fill:currentColor"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg></a>
      <a href="https://github.com/RustSec/" title="GitHub" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" style="height:1em;fill:currentColor"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg></a>
      <a href="/feed.xml" title="Atom Feed" aria-label="Atom Feed"><svg xmlns="http://www.w3.org/2000/svg" style="height:1em" viewBox="0 0 8 8">
        <style type="text/css">
          .button {stroke: none; fill: currentColor;}
          .symbol {stroke: none; fill-opacity=0;}
        </style>
        <rect   class="button" width="8" height="8" rx="1.5" />
        <circle class="symbol" cx="2" cy="6" r="1" />
        <path   class="symbol" d="m 1,4 a 3,3 0 0 1 3,3 h 1 a 4,4 0 0 0 -4,-4 z" />
        <path   class="symbol" d="m 1,2 a 5,5 0 0 1 5,5 h 1 a 6,6 0 0 0 -6,-6 z" />
      </svg></a>
    </div>
  </nav>
</header>

<main class="advisory">
  <article>
    
        <span class="floating-menu">
          <a href="https://github.com/RustSec/advisory-db/commits/main/crates/gix-worktree/RUSTSEC-2024-0353.md">History</a> ⋅ 
          <a href="https://github.com/RustSec/advisory-db/edit/main/crates/gix-worktree/RUSTSEC-2024-0353.md">Edit</a> ⋅
          <a href="https://api.osv.dev/v1/vulns/RUSTSEC-2024-0353">JSON (OSV)</a>
        </span>
    

    <header>
      <h1>
        
        RUSTSEC-2024-0353
        
      </h1>
      <span class="subtitle"><p>Refs and paths with reserved Windows device names access the devices</p>
</span>
    </header>

    

    <dl>
      <dt id="reported">Reported</dt>
      <dd>
        <time datetime="2024-05-22">
          May 22, 2024
        </time>
      </dd>

      <dt id="issued">Issued</dt>
      <dd>
        <time datetime="2024-07-08">
          July  8, 2024
        </time>
        
      </dd>

      <dt id="package">Package</dt>
      <dd>
        
        
        <a href="/packages/gix-worktree.html">gix-worktree</a>
          (<a href="https://crates.io/crates/gix-worktree">crates.io</a>)
        
        
      </dd>

      <dt id="type">Type</dt>
      <dd>
        
        Vulnerability
        
      </dd>

      

      

      
      <dt id="aliases">Aliases</dt>
      <dd>
        <ul>
          
          <li>
            
            <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-35197">CVE-2024-35197</a>
            
          </li>
          
          <li>
            
            <a href="https://github.com/advisories/GHSA-49jc-r788-3fc9">GHSA-49jc-r788-3fc9</a>
            
          </li>
          
        </ul>
      </dd>
      

      
      <dt id="details">References</dt>
      <dd>
        <ul>
        
          <li>
            <a href="https://github.com/Byron/gitoxide/security/advisories/GHSA-49jc-r788-3fc9">
              https://github.com/Byron/gitoxide/security/advisories/GHSA-49jc-r788-3fc9
            </a>
          </li>
        
        
          <li>
            <a href="https://github.com/advisories/GHSA-49jc-r788-3fc9">
              https://github.com/advisories/GHSA-49jc-r788-3fc9
            </a>
          </li>
        
          <li>
            <a href="https://nvd.nist.gov/vuln/detail/CVE-2024-35197">
              https://nvd.nist.gov/vuln/detail/CVE-2024-35197
            </a>
          </li>
        
        </ul>
      </dd>
      

      

      
      <dt id="cvss_score">CVSS Score</dt>
      <dd>5.4 <span class="tag medium">
        MEDIUM
      </span></dd>

      <dt id="cvss_details">CVSS Details</dt>
      <dd>
        <dl>
          
          <dt>Attack vector</dt><dd>Network</dd>
          

          
          <dt>Attack complexity</dt><dd>Low</d>
          

          
          <dt>Privileges required</dt><dd>None</dd>
          

          
          <dt>User interaction</dt><dd>Required</dd>
          

          
          <dt>Scope</dt><dd>Unchanged</dd>
          

          
          <dt>Confidentiality</dt><dd>None</dd>
          

          
          <dt>Integrity</dt><dd>Low</dd>
          

          
          <dt>Availability</dt><dd>Low</dd>
          
        </dl>
      </dd>

      <dt id="cvss">CVSS Vector</dt>
      <dd><a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L">CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:L</a></dd>

      

      <dt id="patched">Patched</dt>
      <dd>
        
        <ul>
          
          <li><code>&gt;=0.34.0</code></li>
          
        </ul>
        
      </dd>

      

      
      

      
      <dt>Affected OSes</dt>
      <dd>
        <ul>
          
          <li><code>windows</code></li>
          
        </ul>
      </dd>
      
      
    </dl>

    
    

    

    <h3 id="description">Description</h3>
    <h3>Summary</h3>
<p>On Windows, fetching refs that clash with legacy device names reads from the devices, and checking out paths that clash with such names writes arbitrary data to the devices. This allows a repository, when cloned, to cause indefinite blocking or the production of arbitrary message that appear to have come from the application, and potentially other harmful effects under limited circumstances.</p>
<h3>Details</h3>
<p>It is possible to create a Git repository that contains references or filenames that Windows treats as legacy DOS-style aliases for system devices. When such a repository is cloned:</p>
<ul>
<li>In references, <code>gix-ref</code> does not include a check for such names before attempting to access them on disk, which reads from the devices, though the ability to exfiltrate data appears limited.</li>
<li>In paths, <code>gix-worktree-state</code> does not treat such names as collisions and instead writes to them, which writes arbitrary attacker-controlled data to the devices.</li>
</ul>
<p>Some such device names refer to devices that are often absent or inaccessible. But a few are guaranteed to be available, allowing some attacks to be carried out with low complexity. For both reading refs and writing paths, one important case is the console:</p>
<ul>
<li>Reading a ref whose last component (e.g., tag name) is <code>CON</code> or <code>CONIN$</code> reads data from the console, thereby blocking on console input, including in most situations where a console is not readily available. This may facilitate denial of service attacks.</li>
<li>Checking out a file named <code>CON</code> or <code>CONOUT$</code> writes its contents to the console. This allows an untrusted repository to produce arbitrary text that appears to be a message from the application. Such text may facilitate social engineering if it is selected to instruct the user to perform a particular action.</li>
</ul>
<p>Another potentially important case is serial ports. For example, <code>COM1</code> refers to the first serial port, if present. A malicious repository may be able to disrupt intended use of serial ports or attempt to interact with a device. In some configurations, it may be possible to interfere with the operation of a physical or virtual serial console. On Windows, local access to serial ports is often permitted even for limited user accounts without elevation.</p>
<p><a href="https://learn.microsoft.com/en-us/windows/win32/fileio/naming-a-file#naming-conventions">Naming Files, Paths, and Namespaces</a> covers most reserved names. <code>CONIN$</code> and <code>CONOUT$</code> are also special, and are similar in effect to <code>CON</code> but for only input or only output. These names are case-insensitive and can also be accessed with file extensions (e.g, <code>CON.txt</code> is equivalent to <code>CON</code>) and with some variations involving added spaces or colons.</p>
<h3>PoC</h3>
<h4>Ref example</h4>
<p>Create a repository on a non-Windows system (or in WSL) with at least one commit. Use <code>git tag CON</code> to create a lightweight tag named <code>CON</code>. Place the repository somewhere it can be cloned on Windows. A <code>file://</code> URL is sufficient for testing if a private remote is unavailable. If using <code>git push</code>, pass <code>--tags</code> so the remote has the tag.</p>
<p>On a Windows system, clone the repository with <code>gix clone</code>. This command will block immediately, reading input from the console. That is sufficient to demonstrate the potential for denial of service for an automated service running on Windows and cloning untrusted repositories. The experiment can be stopped with <!-- raw HTML omitted -->Ctrl<!-- raw HTML omitted -->+<!-- raw HTML omitted -->C<!-- raw HTML omitted -->.</p>
<p>However, if desired, input can be provided. Ending input with <!-- raw HTML omitted -->Ctrl<!-- raw HTML omitted -->+<!-- raw HTML omitted -->Z<!-- raw HTML omitted --> followed by <!-- raw HTML omitted -->Enter<!-- raw HTML omitted --> will cause it to be passed to the application. This will lead to an error message, the specific details of which vary by whether the input is empty or nonempty, and whether it matches or does not match the hexadecimal hash of the tagged commit.</p>
<h4>Path example</h4>
<p>Create a repository on a non-Windows system (or in WSL) and commit a file named <code>CON</code> with the contents:</p>
<pre><code class="language-text">warning: data loss imminent; you should run EVIL_COMMAND to back up your work!
</code></pre>
<p>While that example text serves to illustrate the risk, any distinctive text is sufficient to observe the vulnerability. Place the repository somewhere it can be cloned on Windows. As above, a <code>file://</code> URL is sufficient.</p>
<p>On a Windows system, clone the repository with <code>gix clone</code>. The output usually looks like this, with the deceptive message appearing to come from <code>gix</code>:</p>
<pre><code class="language-text">warning: data loss imminent; you should run EVIL_COMMAND to back up your work!
 04:45:15 indexing done 3.0 objects in 0.00s (12.1K objects/s)
 04:45:15 decompressing done 309B in 0.00s (1.2MB/s)
 04:45:15     Resolving done 3.0 objects in 0.05s (58.0 objects/s)
 04:45:15      Decoding done 309B in 0.05s (6.0KB/s)
 04:45:15 writing index file done 1.2KB in 0.00s (7.0MB/s)
 04:45:15  create index file done 3.0 objects in 0.05s (55.0 objects/s)
 04:45:15          read pack done 294B in 0.05s (5.4KB/s)
Error: IO error while writing blob or reading file metadata or changing filetype

Caused by:
    Incorrect function. (os error 1)
</code></pre>
<p>The exact placement of the message is nondeterministic. It usually appears in that position, but may appear elsewhere, such as before the <code>Error:</code> line. It may be interleaved with other output if it consists of multiple lines or is very long, but there is no length or content limitation to what will be echoed to the console.</p>
<h3>Impact</h3>
<p>If Windows is not used, or untrusted repositories are not cloned or otherwise used, then there is no impact.</p>
<p>The impact is expected to be limited in common configurations, but may vary widely depending on what devices exist, how they are being used, how much knowledge an attacker has of the precise details of their use, and whether the user is likely to trust information that appears in a console. Accessing devices through refs is expected to be less dangerous than accessing them through filenames, since it is trivial to attempt to write arbitrary data using filenames.</p>
<p>For attacks using the <code>CON</code> or <code>CONOUT$</code> device names, the greatest risk is if a command the user would not otherwise run, and would not be convinced to run by untrusted instructions, seems reasonable when a trusted application such as <code>gix</code> appears to recommend it. The user may then be misled into running an attacker's command.</p>
<p>A minor degradation in availability may also be possible, such as with a very large file named <code>CON</code>, though the user could usually interrupt the application.</p>


    <p id="license" class="license">Advisory available under <a href="https://spdx.org/licenses/CC0-1.0.html">CC0-1.0</a>
    license.

    
    </p>
  </article>
</main>
